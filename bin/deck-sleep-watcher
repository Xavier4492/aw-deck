#!/usr/bin/env bash
set -euo pipefail
# Dépendance : gdbus (paquet libglib2.0-bin)
command -v gdbus >/dev/null 2>&1 || { echo "Install: sudo apt install -y libglib2.0-bin"; exit 1; }

# Écoute PrepareForSleep(true/false) sur le bus système
gdbus monitor --system --dest org.freedesktop.login1 --object-path /org/freedesktop/login1 | \
while IFS= read -r line; do
  case "$line" in
    *PrepareForSleep\(*true*\)*) /home/xavier/.local/bin/streamdeckc -d 0 -a SET_PAGE -p 0 >/dev/null 2>&1 || true ;;
  esac
done
